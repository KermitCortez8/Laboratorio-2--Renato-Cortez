# Firebase Storage Signed URL Upload Example

<p>
  <!-- iOS -->
  <img alt="Supports Expo iOS" longdesc="Supports Expo iOS" src="https://img.shields.io/badge/iOS-4630EB.svg?style=flat-square&logo=APPLE&labelColor=999999&logoColor=fff" />
  <!-- Android -->
  <img alt="Supports Expo Android" longdesc="Supports Expo Android" src="https://img.shields.io/badge/Android-4630EB.svg?style=flat-square&logo=ANDROID&labelColor=A4C639&logoColor=fff" />
</p>

This example demonstrates how you can upload large files to Firebase Storage via [Signed URL](https://cloud.google.com/storage/docs/access-control/signed-urls#signing-resumable) generated by [Firebase Admin sdk](https://firebase.google.com/docs/storage/admin/start). 
This example is adapted from [with-firebase-storage-upload](/with-firebase-storage-upload), but does not use XHR or Firebase JS SDK for uploading, it uses `expo-file-system` `FileSystem.uploadAsync` instead, which prevents crashes when uploading large files. 
A 2.75 GB quicktime video was uploaded successfully. 

## üöÄ How to use

### Deploy Firebase Function
- Create a new firebase project or use existing one
- Enable Anonymous sign in and choose location for storage
- Replace `YOUR_FIREBASE_PROJECT_ID` with your firebase project id in [.firebaserc](./.firebaserc)
- Run `cd functions`
- Run `npm install`
- Run `firebase deploy --only functions`

You should see something like this in console
```
=== Deploying to 'YOUR_FIREBASE_PROJECT_ID'...

i  deploying functions
i  functions: ensuring required API cloudfunctions.googleapis.com is enabled...
i  functions: ensuring required API cloudbuild.googleapis.com is enabled...
i  functions: ensuring required API artifactregistry.googleapis.com is enabled...
‚úî  functions: required API cloudfunctions.googleapis.com is enabled
‚úî  functions: required API cloudbuild.googleapis.com is enabled
‚úî  functions: required API artifactregistry.googleapis.com is enabled
i  functions: preparing functions directory for uploading...
i  functions: packaged functions (24.62 KB) for uploading
‚úî  functions: functions folder uploaded successfully
i  functions: updating Node.js 14 function getResumableUploadUrl(us-central1)...
‚úî  functions[getResumableUploadUrl(us-central1)] Successful update operation.
Function URL (getResumableUploadUrl(us-central1)): https://us-central1-YOUR_FIREBASE_PROJECT_ID.cloudfunctions.net/getResumableUploadUrl
i  functions: cleaning up build files...

```
### Run Expo
- Add your firebase config to [App.jsx](./App.jsx)
- Run `yarn` or `npm install`
- Run [`expo start`](https://docs.expo.dev/versions/latest/workflow/expo-cli/), try it out.
- Take a new picture or upload one from your library
- See the image being rendered from Firebase

## üìù Notes

- [Firebase Storage API](https://firebase.google.com/docs/storage/web/upload-files)
- [Expo Firebase guide](https://docs.expo.dev/versions/latest/guides/using-firebase/)
